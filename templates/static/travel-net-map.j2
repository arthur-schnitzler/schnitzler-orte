{% extends "templates/partials/base.j2" %}
{% block title %}Schnitzlers Reisen als Netzwerk auf Karte{% endblock %}
{% block scriptHeader %}
<!-- Prevent StoryMap from loading on this page -->
<style>body { display: none; }</style>
<script>
// Remove storymap script before it loads
document.addEventListener('DOMContentLoaded', function() {
    document.body.style.display = 'block';
});
</script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
// Save the correct Leaflet before StoryMap loads
window.OriginalLeaflet = L;
console.log('Saved Leaflet version:', L.version, 'has svg:', typeof L.svg);

// Wait for Leaflet to load, then load network plugin
(function() {
    var script = document.createElement('script');
    script.src = 'static/libs/leaflet-network.js';
    script.onload = function() {
        console.log('leaflet-network loaded, saving to window');
        window.LeafletNetworkLayer = L.NetworkLayer;
        window.leafletNetworkLayer = L.networkLayer;
    };
    document.head.appendChild(script);
})();
</script>

<style>

    #tooltip {
        position: absolute;
        top: 120px;
        left: 20px;
        padding: 20px;
        background: #CCC;
        color: #222;
        z-index: 999;
        display: none;
    }

</style>
{% endblock %}


{% block content %}

<div class="card p-2">
    <div class="card-header">
        <h1>Schnitzlers Reisen als Netzwerk auf einer Karte</h1>
<!--     <div id="controls">
            Quelle: <input class="mode-ctrl form-check-input" type="radio" name="mode" value="SOURCE"><br/>
            Sink (show the sites sink connections - it consumes): <input class="mode-ctrl form-check-input" type="radio" name="mode" value="SINK"><br/>
            Both/Bidirectional: <input class="mode-ctrl form-check-input" type="radio" name="mode" value="BOTH"><br/>
            Any: <input class="mode-ctrl form-check-input" type="radio" name="mode" value="ANY" checked> <br/> 
            <button type="button" class="btn btn-dark" id="clear">Clear selection</button>
            <button type="button" class="btn btn-dark" id="toggleScope" title="When local, connections will be colored by their relationship strength with the selected target">
                Toggle Weighting Scope
            </button> -->
        </div>
        
    </div>
    <div class="card-body">
        <div id="map" style="width: 100%; height: 800px"></div>
        <div id="tooltip"></div>
  </div>
</div>
{% endblock %}
{% block scriptbody %}
<script>
// Wait for everything to load
window.addEventListener('load', function() {
    var script = document.createElement('script');
    script.src = 'static/js/travel-net-map.js?v=11';
    document.body.appendChild(script);
});
</script>
{% endblock %}